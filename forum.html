<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <section id="forumSection" class="container mx-auto p-4">
        <h2 class="text-2xl font-bold mb-4">Forum</h2>
        <div class="bg-white p-6 rounded-lg shadow-md">
            <textarea id="chatInput" class="w-full px-4 py-2 border rounded-lg" placeholder="Savol yoki fikr yozing..."></textarea>
            <button onclick="sendMessage()" class="mt-2 px-6 py-3 bg-blue-600 text-white rounded-lg">Yuborish</button>
            <div id="chatMessages" class="mt-4">
                <!-- JS orqali forumdagi chat xabarlari -->
            </div>
        </div>
    </section>

    <script>
        // Chat Section
        function loadChatData() {
            const chatMessagesDiv = document.getElementById('chatMessages');
            const chatInput = document.getElementById('chatInput');

            // Load saved messages from localStorage
            const savedMessages = JSON.parse(localStorage.getItem('chatMessages')) || [];
            savedMessages.forEach(message => {
                const messageElement = createMessageElement(message.text, message.timestamp, message.user);
                chatMessagesDiv.appendChild(messageElement);
            });

            // Send message functionality
            function sendMessage() {
                const message = chatInput.value.trim();
                const user = "Foydalanuvchi"; // Foydalanuvchi nomi (keyinchalik dinamik qilish mumkin)
                const timestamp = new Date().toLocaleTimeString();

                if (message) {
                    const messageElement = createMessageElement(message, timestamp, user);
                    chatMessagesDiv.appendChild(messageElement);

                    // Save message to localStorage
                    savedMessages.push({ text: message, timestamp, user });
                    localStorage.setItem('chatMessages', JSON.stringify(savedMessages));

                    chatInput.value = ''; // Inputni tozalash
                }
            }

            // Create message element with timestamp and delete button
            function createMessageElement(message, timestamp, user) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('p-2', 'mb-2', 'bg-gray-100', 'rounded-lg', 'flex', 'justify-between', 'items-center');

                const messageContent = document.createElement('div');
                messageContent.innerHTML = `<strong>${user}</strong> (${timestamp}): ${message}`;
                messageElement.appendChild(messageContent);

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'O\'chirish';
                deleteButton.classList.add('text-red-600', 'hover:text-red-800');
                deleteButton.onclick = function() {
                    chatMessagesDiv.removeChild(messageElement);
                    const index = savedMessages.findIndex(msg => msg.text === message && msg.timestamp === timestamp);
                    if (index !== -1) {
                        savedMessages.splice(index, 1);
                        localStorage.setItem('chatMessages', JSON.stringify(savedMessages));
                    }
                };
                messageElement.appendChild(deleteButton);

                return messageElement;
            }

            // Send message on Enter key press
            chatInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    sendMessage();
                }
            });
        }

        // `DOMContentLoaded`ni ishlatish
        document.addEventListener('DOMContentLoaded', function () {
            loadChatData(); // Chat data yuklashni boshlash
        });
    </script>
</body>
</html>